/*
 * button.c
 *
 *  Created on: Nov 4, 2022
 *      Author: huynh
 */

#include "button.h"

int MODE_BT = 0;
int TIME_BT = 0;
int SAVE_BT = 0;

int KeyReg0 = NORMAL_STATE;
int KeyReg1 = NORMAL_STATE;
int KeyReg2 = NORMAL_STATE;
int MODE_key = NORMAL_STATE;

int KeyReg3 = NORMAL_STATE;
int KeyReg4 = NORMAL_STATE;
int KeyReg5 = NORMAL_STATE;
int TIME_key = NORMAL_STATE;

int KeyReg6 = NORMAL_STATE;
int KeyReg7 = NORMAL_STATE;
int KeyReg8 = NORMAL_STATE;
int SAVE_key = NORMAL_STATE;

int TimeOutForKeyPress = 300;
int TimeOutINC_KEY =  300;
int TimeOutDEC_KEY =  300;

int MODE_PRESSED(){
	if(MODE_BT == 1){
		MODE_BT = 0;
		return 1;
	}
	return 0;
}

int TIME_PRESSED(){
	if(TIME_BT == 1){
		TIME_BT = 0;
		return 1;
	}
	return 0;
}

int SAVE_PRESSED(){
	if(SAVE_BT == 1){
		SAVE_BT = 0;
		return 1;
	}
	return 0;
}

void MODE(){
	  KeyReg0 = KeyReg1;
	  KeyReg1 = MODE_key;
	  MODE_key = HAL_GPIO_ReadPin(RESET_GPIO_Port, RESET_Pin);
	  if ((KeyReg0 == KeyReg1) && (KeyReg1 == MODE_key)){
		if (KeyReg2 != MODE_key){
			KeyReg2 = MODE_key;
		  if (MODE_key == PRESSED_STATE){
			TimeOutForKeyPress = 200;
			MODE_BT = 1;
		  }
		}
	  }
}

void input_INC(){
	  KeyReg3 = KeyReg4;
	  KeyReg4 = INC;
	  INC = HAL_GPIO_ReadPin(INC_GPIO_Port, INC_Pin);
	  if ((KeyReg3 == KeyReg4) && (KeyReg4 == INC)){
	    if (KeyReg5 != INC){
	    	KeyReg5 = INC;
	      if (INC == PRESSED_STATE){
	    	  TimeOutINC_KEY = 300;
	    	  BUTTON_INC = 1;
	      }
	    }
	    else if(INC == PRESSED_STATE){
	    	TimeOutINC_KEY --;
	        if (TimeOutINC_KEY == 0){
	        	INC_LONG = 1;
	        	TimeOutINC_KEY = 100;
	        }
	    }
	  }
}

void input_DEC(){
	  KeyReg6 = KeyReg7;
	  KeyReg7 = DEC;
	  DEC = HAL_GPIO_ReadPin(DEC_GPIO_Port, DEC_Pin);
	  if ((KeyReg6 == KeyReg7) && (KeyReg7 == DEC)){
	    if (KeyReg8 != DEC){
	    	KeyReg8 = DEC;
	      if (DEC == PRESSED_STATE){
	    	  TimeOutDEC_KEY = 300;
	    	  BUTTON_DEC = 1;
	      }
	    }
	    else if(DEC == PRESSED_STATE){
	    	TimeOutDEC_KEY --;
	        if (TimeOutDEC_KEY == 0){
	        	DEC_LONG = 1;
	        	TimeOutDEC_KEY = 100;
	        }
	    }
	  }
}

void getKeyInput(){
	input_DEC();
	input_INC();
	input_RESET();
}
